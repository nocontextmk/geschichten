<!doctype html>
<html lang="de">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Kurzgeschichten Luzern — jeden Tag</title>
  <style>
    :root{
      --maxw:720px; --bg:#fff; --text:#0a0a0a; --muted:#5a5a5a; --accent:#0b5ed7; --paper:#fbfbfb;
      font-family: Inter, system-ui, -apple-system, "Segoe UI", Roboto, "Helvetica Neue", Arial;
    }
    html,body{height:100%;margin:0;background:var(--bg);color:var(--text)}
    .wrap{max-width:var(--maxw);margin:28px auto;padding:28px;background:var(--paper);border-radius:14px;box-shadow:0 6px 24px rgba(10,10,10,0.06)}
    header{display:flex;align-items:center;gap:12px}
    h1{font-size:22px;margin:0}
    p.lead{margin:8px 0 18px;color:var(--muted);font-size:15px}
    .meta{font-size:13px;color:var(--muted);margin-bottom:18px}
    .stories{display:flex;flex-direction:column;gap:18px}
    article.story{padding:18px;border-radius:10px;background:white;box-shadow:0 1px 0 rgba(0,0,0,0.04);border:1px solid #e0e0e0}
    article.story h2{margin:0 0 12px;font-size:18px}
    article.story p{margin:0 0 14px;line-height:1.6;font-size:17px}
    .vocab{margin-top:12px;font-size:14px;color:var(--muted)}
    footer{margin-top:18px;font-size:13px;color:var(--muted);display:flex;justify-content:space-between;align-items:center}
    .small{font-size:12px;color:var(--muted)}
    .btn{background:transparent;border:1px solid var(--accent);color:var(--accent);padding:6px 10px;border-radius:8px;font-size:13px;cursor:pointer}
    .btn:hover{background:rgba(11, 94, 215, 0.05)}
  </style>
</head>
<body>
  <main class="wrap" role="main" aria-labelledby="title">
    <header>
      <svg width="44" height="44" viewBox="0 0 24 24" aria-hidden="true">
        <rect x="1.5" y="3" width="21" height="18" rx="3" fill="#0b5ed7" />
        <circle cx="7.5" cy="10" r="1.6" fill="#fff" />
        <circle cx="16.5" cy="14" r="1.6" fill="#fff" />
      </svg>
      <div>
        <h1 id="title">Kurzgeschichten Luzern</h1>
        <p class="lead">Jeden Tag zwei kurze Geschichten auf Deutsch — kindgerecht (≈ 8 Jahre). Klarer Text, kurze Absätze, Lernwörter.</p>
      </div>
    </header>

    <div class="meta" id="meta">...lade...</div>

    <section class="stories" id="stories" aria-live="polite"></section>

    <footer>
      <div class="small">Automatisch erzeugt anhand des Datums (Zeitzone: Europe/Zurich).</div>
      <div class="footer-buttons">
        <button class="btn" id="archiveBtn">Archiv</button>
        <button class="btn" id="printBtn">Drucken</button>
      </div>
    </footer>
  </main>

  <script>
  function zurichNow() {
    const fmt = new Intl.DateTimeFormat('de-DE', {
      timeZone: 'Europe/Zurich',
      year: 'numeric', month: '2-digit', day: '2-digit',
      hour: '2-digit', minute: '2-digit', second: '2-digit',
      hour12: false
    });
    const parts = fmt.formatToParts(new Date());
    const get = (t) => parts.find(p => p.type===t).value;
    const s = `${get('year')}-${get('month')}-${get('day')}T${get('hour')}:${get('minute')}:${get('second')}`;
    return new Date(s);
  }

  function pad(n){return n.toString().padStart(2,'0')}
  function dateSeedKey(d) { return d.getFullYear() + '-' + pad(d.getMonth()+1) + '-' + pad(d.getDate()); }
  function seededRandom(seed) {
    let h = 2166136261 >>> 0;
    for (let i=0;i<seed.length;i++) h = (h ^ seed.charCodeAt(i)) * 16777619 >>> 0;
    let state = h;
    return function() { state = (state * 1664525 + 1013904223) >>> 0; return state / 4294967296; }
  }

  const vocab = {
    personen: ["Mia","Lukas","Paula","Jonas","Sara","Noah","Ben","Emma","Lea","Finn"],
    orte: ["Luzern","See","Pilatus","Altstadt","Schule","Spielplatz","Bibliothek","Markt","Wald","Brücke"],
    gegenstaende: ["Velo","Ball","Buch","Rucksack","Lampe","Brille","Schlüssel","Luftballon","Korb","Schirm"],
    tiere: ["Hund","Katze","Ente","Fisch","Kuh","Ameise","Schmetterling","Igel","Vogel","Libelle"],
    aktivitaeten: ["fahren","lesen","spielen","rennen","malen","lernen","singen","suchen","bauen","helfen"],
    gefuehle: ["glücklich","neugierig","mutig","ruhig","aufgeregt","stolz","freundlich","geduldig","fröhlich","zufrieden"],
    lehrthemen: ["Natur","Wetter","Verkehrssicherheit","Zahlen","Lesen","Freundschaft","Farben","Tiere","Berufe","Musik"]
  };

  const themen = {
    kurzgeschichten: [
      "Der vergessene Schlüssel",
      "Ein besonderer Fund",
      "Die mutige Entscheidung",
      "Eine kleine Überraschung",
      "Freundschaft im Park",
      "Das geheimnisvolle Geräusch",
      "Ein Tag voller Farben",
      "Die hilfsbereite Geste",
      "Ein unerwartetes Abenteuer",
      "Das Lächeln eines Fremden"
    ]
  };

  function choose(rng, arr){ return arr[Math.floor(rng()*arr.length)]; }

  function generateShortStory(rng, storyNum) {
    const name = choose(rng,vocab.personen);
    const place = choose(rng,vocab.orte);
    const object = choose(rng,vocab.gegenstaende);
    const animal = choose(rng,vocab.tiere);
    const feeling = choose(rng,vocab.gefuehle);
    const title = choose(rng,themen.kurzgeschichten);

    // 4-6 краткие предложения для короткой истории
    const sentences = [
      `${name} ging an einem sonnigen Tag zum ${place}.`,
      `Plötzlich fand ${name} einen ${object} auf dem Boden.`,
      `${name} war ${feeling} und überlegte, wem der ${object} gehören könnte.`,
      `Auf der Suche nach dem Besitzer traf ${name} eine kleine ${animal}.`,
      `Die ${animal} sah freundlich aus und folgte ${name} ein Stück.`,
      `Zum Glück fand ${name} die Besitzerin des ${object} am ${place}.`,
      `Es war eine ältere Frau, die sehr dankbar war.`,
      `${name} fühlte sich ${feeling} und lächelte den ganzen Weg nach Hause.`
    ];

    // Выбираем 4-6 случайных предложений
    const sentenceCount = 4 + Math.floor(rng() * 3); // 4, 5 или 6
    const shuffled = [...sentences].sort(() => rng() - 0.5);
    const storyText = shuffled.slice(0, sentenceCount);

    return {
      title: storyNum === 1 ? `1. ${title}` : `2. ${title}`,
      text: storyText,
      vocab: extractVocab(storyText)
    };
  }

  function extractVocab(lines){
    const words = new Set();
    lines.forEach(L => {
      L.replace(/[,\.!?:;]/g,'').split(/\s+/).forEach(w => { 
        const w2 = w.trim(); 
        if(w2.length > 0 && w2.length <= 12) words.add(w2); 
      });
    });
    return Array.from(words);
  }

  function storiesForDate(d){
    const key = dateSeedKey(d);
    const rng = seededRandom(key);
    return [
      generateShortStory(rng, 1),
      generateShortStory(rng, 2)
    ];
  }

  function displayStories() {
    const now = zurichNow();
    const showDate = now.getHours() >= 15 ? now : new Date(now.getTime() - 24*3600*1000);
    const dateStr = dateSeedKey(showDate);
    const stories = storiesForDate(showDate);

    document.getElementById('meta').textContent = `Datum: ${dateStr} · Zwei kurze Geschichten (je 4-6 Sätze). Angezeigt ab 15:00 (Zeitzone Zürich).`;

    const storiesEl = document.getElementById('stories');
    storiesEl.innerHTML='';
    stories.forEach(s=>{
      const art=document.createElement('article'); 
      art.className='story';
      
      const h=document.createElement('h2'); 
      h.textContent=s.title;
      art.appendChild(h);
      
      s.text.forEach(p=>{
        const pEl=document.createElement('p'); 
        pEl.textContent=p; 
        art.appendChild(pEl);
      });
      
      const vocabBox=document.createElement('div'); 
      vocabBox.className='vocab';
      vocabBox.innerHTML=`<strong>Wortschatz:</strong> ${s.vocab.join(', ')}.`;
      art.appendChild(vocabBox);
      
      storiesEl.appendChild(art);
    });
  }

  displayStories();
  
  document.getElementById('printBtn').addEventListener('click',()=>window.print());
  
  document.getElementById('archiveBtn').addEventListener('click', function() {
    alert("Das Archiv wird bald verfügbar sein! Hier können Sie ältere Geschichten lesen.");
  });
  
  setInterval(displayStories, 60000);
  </script>
</body>
</html>
